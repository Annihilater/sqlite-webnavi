<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>乔木精选推荐 | 波普艺术风格</title>
    <meta name="description" content="发现最佳AI与知识工具集，提升工作效率">
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png">
    <link rel="manifest" href="/favicon/site.webmanifest">
    <link rel="shortcut icon" href="/favicon/favicon.ico">
    <link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-100-M/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Bangers&display=swap">
    
    <style>
        /* 波普艺术风格配色 */
        :root {
            /* 波普艺术原色 */
            --pop-red: #FF0000;
            --pop-yellow: #FFFF00;
            --pop-blue: #0000FF;
            --pop-black: #000000;
            --pop-white: #FFFFFF;
            
            /* 文本颜色 */
            --text-primary: #000000;
            --text-secondary: #333333;
            
            /* 背景颜色 */
            --bg-primary: #FFFFFF;
            --bg-secondary: #FFFF00;
            
            /* 卡片样式 */
            --card-bg: #FFFFFF;
            --card-border: #000000;
        }

        /* 全局样式 */
        body {
            font-family: 'Comic Sans MS', 'Bangers', cursive;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            line-height: 1.6;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23000000' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        /* 波普风格标题 */
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Bangers', 'Impact', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* 漫画风格对话气泡 */
        .speech-bubble {
            position: relative;
            background: var(--pop-yellow);
            border: 3px solid var(--pop-black);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: 5px 5px 0px var(--pop-black);
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            width: 0;
            height: 0;
            border: 20px solid transparent;
            border-top-color: var(--pop-yellow);
            border-bottom: 0;
            margin-left: -20px;
            z-index: 1;
        }

        .speech-bubble:before {
            content: '';
            position: absolute;
            bottom: -23px;
            left: 50%;
            width: 0;
            height: 0;
            border: 23px solid transparent;
            border-top-color: var(--pop-black);
            border-bottom: 0;
            margin-left: -23px;
            z-index: 0;
        }

        /* 半调网点效果 */
        .halftone {
            position: relative;
            overflow: hidden;
        }

        .halftone:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: radial-gradient(var(--pop-black) 1px, transparent 1px);
            background-size: 4px 4px;
            opacity: 0.2;
            z-index: 1;
            pointer-events: none;
        }

        /* 波普风格卡片 */
        .pop-card {
            background-color: var(--pop-white);
            border: 3px solid var(--pop-black);
            border-radius: 0;
            overflow: hidden;
            transition: transform 0.3s;
            height: 100%;
            display: block;
            position: relative;
            box-shadow: 8px 8px 0 var(--pop-black);
            text-decoration: none;
            color: inherit;
            margin-bottom: 20px;
        }

        .pop-card:hover {
            transform: translateY(-5px);
        }

        /* 爆炸形状 */
        .explosion {
            position: absolute;
            background-color: var(--pop-yellow);
            color: var(--pop-black);
            font-weight: bold;
            padding: 10px 15px;
            border: 3px solid var(--pop-black);
            transform: rotate(-15deg);
            z-index: 10;
            box-shadow: 3px 3px 0 var(--pop-black);
        }

        /* 拟声词样式 */
        .sound-effect {
            font-family: 'Bangers', cursive;
            font-size: 24px;
            font-weight: bold;
            color: var(--pop-red);
            text-shadow: 2px 2px 0 var(--pop-black);
            transform: rotate(-5deg);
            display: inline-block;
            margin: 10px 0;
        }

        /* 波普风格导航栏 */
        .pop-navbar {
            background-color: var(--pop-red);
            border-bottom: 3px solid var(--pop-black);
            padding: 15px 0;
        }

        .pop-logo {
            font-family: 'Bangers', cursive;
            font-size: 36px;
            color: var(--pop-yellow);
            text-shadow: 3px 3px 0 var(--pop-black);
            letter-spacing: 2px;
        }

        /* 波普风格按钮 */
        .pop-button {
            background-color: var(--pop-yellow);
            color: var(--pop-black);
            border: 3px solid var(--pop-black);
            padding: 8px 20px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 4px 4px 0 var(--pop-black);
        }

        .pop-button:hover {
            background-color: var(--pop-blue);
            color: var(--pop-white);
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--pop-black);
        }

        /* 波普风格搜索框 */
        .pop-search {
            background-color: var(--pop-white);
            border: 3px solid var(--pop-black);
            padding: 12px 20px;
            width: 100%;
            font-size: 18px;
            box-shadow: 5px 5px 0 var(--pop-black);
        }

        /* 波普风格标签 */
        .pop-tag {
            display: inline-block;
            background-color: var(--pop-blue);
            color: var(--pop-white);
            border: 2px solid var(--pop-black);
            padding: 5px 12px;
            margin-right: 10px;
            margin-bottom: 10px;
            font-weight: bold;
            box-shadow: 3px 3px 0 var(--pop-black);
        }

        /* 波普风格英雄区域 */
        .pop-hero {
            background-color: var(--pop-yellow);
            padding: 60px 0;
            position: relative;
            overflow: hidden;
            border-bottom: 3px solid var(--pop-black);
        }

        /* 网格背景 */
        .pop-grid {
            background-image: linear-gradient(var(--pop-black) 1px, transparent 1px),
                              linear-gradient(90deg, var(--pop-black) 1px, transparent 1px);
            background-size: 30px 30px;
            background-position: -1px -1px;
            opacity: 0.1;
        }

        /* 波普风格页脚 */
        .pop-footer {
            background-color: var(--pop-blue);
            color: var(--pop-white);
            border-top: 3px solid var(--pop-black);
            padding: 40px 0;
        }

        /* 汉堡菜单 */
        .hamburger {
            width: 30px;
            height: 25px;
            position: relative;
            cursor: pointer;
            z-index: 60;
        }

        .hamburger span {
            display: block;
            position: absolute;
            height: 3px;
            width: 100%;
            background: var(--pop-yellow);
            border-radius: 0;
            transition: .25s ease-in-out;
        }

        .hamburger span:nth-child(1) {
            top: 0;
        }

        .hamburger span:nth-child(2), .hamburger span:nth-child(3) {
            top: 10px;
        }

        .hamburger span:nth-child(4) {
            top: 20px;
        }

        .hamburger.active span:nth-child(1) {
            top: 10px;
            width: 0%;
            left: 50%;
        }

        .hamburger.active span:nth-child(2) {
            transform: rotate(45deg);
        }

        .hamburger.active span:nth-child(3) {
            transform: rotate(-45deg);
        }

        .hamburger.active span:nth-child(4) {
            top: 10px;
            width: 0%;
            left: 50%;
        }

        /* 移动菜单 */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: -100%;
            width: 80%;
            height: 100vh;
            background-color: var(--pop-red);
            z-index: 50;
            padding: 2rem 1.5rem;
            transition: left 0.4s;
            box-shadow: 5px 0 25px rgba(0, 0, 0, 0.5);
            overflow-y: auto;
            border-right: 3px solid var(--pop-black);
        }

        .mobile-menu.active {
            left: 0;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s, visibility 0.4s;
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* 主题切换按钮 */
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            border-radius: 0;
            background: var(--pop-yellow);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid var(--pop-black);
            box-shadow: 3px 3px 0 var(--pop-black);
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            top: 3px;
            left: 3px;
            width: 20px;
            height: 20px;
            border-radius: 0;
            background-color: var(--pop-black);
            transition: transform 0.3s;
            border: 1px solid var(--pop-black);
        }

        .dark .theme-toggle {
            background: var(--pop-blue);
        }

        .dark .theme-toggle::after {
            transform: translateX(30px);
            background-color: var(--pop-white);
        }

        /* 响应式调整 */
        @media (max-width: 768px) {
            .pop-logo {
                font-size: 28px;
            }
            
            .pop-card {
                box-shadow: 5px 5px 0 var(--pop-black);
            }
            
            .speech-bubble {
                padding: 10px;
            }
        }

        /* 热门标签 */
        .hot-label {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--pop-red);
            color: var(--pop-white);
            padding: 5px 10px;
            font-weight: bold;
            z-index: 10;
            border: 2px solid var(--pop-black);
            box-shadow: 2px 2px 0 var(--pop-black);
            transform: rotate(-5deg);
        }

        /* 返回顶部按钮 */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--pop-red);
            color: var(--pop-white);
            width: 50px;
            height: 50px;
            border: 3px solid var(--pop-black);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s;
            z-index: 30;
            box-shadow: 4px 4px 0 var(--pop-black);
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-5px);
        }

        /* 赞赏模态框 */
        .donation-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .donation-modal.active {
            opacity: 1;
            visibility: visible;
        }

        .donation-content {
            background-color: var(--pop-white);
            border: 3px solid var(--pop-black);
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            position: relative;
            box-shadow: 10px 10px 0 var(--pop-black);
        }

        .donation-close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--pop-black);
            transition: color 0.3s;
            width: 30px;
            height: 30px;
            background: var(--pop-red);
            border: 2px solid var(--pop-black);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .donation-qrcode {
            max-width: 200px;
            border: 3px solid var(--pop-black);
            margin: 1.5rem auto;
            box-shadow: 5px 5px 0 var(--pop-black);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- 页面加载动画 -->
    <div id="pageLoader" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--pop-white); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; transition: opacity 0.5s ease-out;">
        <div class="sound-effect" style="font-size: 40px;">LOADING!</div>
        <div style="width: 60px; height: 60px; border: 5px solid var(--pop-black); border-top: 5px solid var(--pop-red); animation: spin 1s linear infinite; margin-top: 20px;"></div>
    </div>

    <!-- 波普风格导航栏 -->
    <header class="pop-navbar">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="hamburger md:hidden" id="menuToggle">
                        <span></span>
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                    <a href="#" class="pop-logo">乔木精选!</a>
                </div>
                <div class="hidden md:flex items-center space-x-6">
                    <a href="#ai-tools" class="text-white font-bold">AI工具</a>
                    <a href="#reading" class="text-white font-bold">阅读与知识</a>
                    <a href="#newsletter" class="text-white font-bold">精选Newsletter</a>
                </div>
                <div class="theme-toggle" id="themeToggle" title="切换深色/浅色模式"></div>
            </div>
        </div>
    </header>

    <!-- 移动菜单 -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mb-8">
            <a href="#" class="pop-logo" style="font-size: 28px;">乔木精选!</a>
        </div>
        <nav class="space-y-5">
            <a href="#ai-tools" class="block py-2 text-lg font-bold text-white mobile-link">
                <i class="fas fa-robot mr-3"></i>AI工具
            </a>
            <a href="#reading" class="block py-2 text-lg font-bold text-white mobile-link">
                <i class="fas fa-book-reader mr-3"></i>阅读与知识
            </a>
            <a href="#newsletter" class="block py-2 text-lg font-bold text-white mobile-link">
                <i class="fas fa-newspaper mr-3"></i>精选Newsletter
            </a>
        </nav>
        <div class="mt-8 pt-6 border-t border-black">
            <div class="sound-effect">FOLLOW ME!</div>
            <div class="flex justify-center mt-4">
                <a href="https://github.com/joeseesun" target="_blank" class="pop-button mx-2" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                    <i class="fab fa-github"></i>
                </a>
                <a href="https://twitter.com/vista8" target="_blank" class="pop-button mx-2" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="mailto:vista8@gmail.com" class="pop-button mx-2" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                    <i class="fas fa-envelope"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- 遮罩层 -->
    <div class="overlay" id="overlay"></div>

    <!-- 波普风格英雄区域 -->
    <section class="pop-hero halftone">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <div class="speech-bubble mx-auto" style="max-width: 600px;">
                    <h1 class="text-4xl md:text-5xl font-bold mb-4">WOW! 效率工具集锦!</h1>
                    <p class="text-lg md:text-xl mb-0">发现最佳AI、阅读与知识管理工具，<span class="font-bold">提升工作效率</span></p>
                </div>
                
                <div class="sound-effect mb-8">BOOM! POW! ZAP!</div>
                
                <div style="max-width: 700px; margin: 0 auto; position: relative;">
                    <input type="text" id="searchInput" class="pop-search" placeholder="搜索工具、平台或技术...">
                    <div class="explosion" style="top: -20px; right: -20px;">
                        搜索!
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- 波普风格分类标签 -->
    <div class="container mx-auto px-4 mt-10">
        <div class="flex overflow-x-auto space-x-4 pb-4 category-tabs">
            <div class="pop-button active" data-category="all">
                <i class="fas fa-th-large mr-2"></i>全部
            </div>
            <div class="pop-button" data-category="ai-tools" style="background-color: var(--pop-white);">
                <i class="fas fa-robot mr-2"></i>AI工具
            </div>
            <div class="pop-button" data-category="reading" style="background-color: var(--pop-white);">
                <i class="fas fa-book-reader mr-2"></i>阅读与知识
            </div>
            <div class="pop-button" data-category="newsletter" style="background-color: var(--pop-white);">
                <i class="fas fa-newspaper mr-2"></i>精选Newsletter
            </div>
        </div>
    </div>

    <!-- 主内容区域 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 分类内容将通过JavaScript动态渲染 -->
    </main>

    <!-- 波普风格页脚 -->
    <footer class="pop-footer">
        <div class="container mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-8 md:mb-0 text-center md:text-left">
                    <a href="#" class="pop-logo">乔木精选!</a>
                    <p class="mt-3 text-lg">精选AI与知识工具集</p>
                    <div class="sound-effect mt-4">WHAM! BAM!</div>
                </div>
                
                <div class="flex flex-col items-center md:items-end">
                    <div class="flex space-x-4 mb-4">
                        <a href="https://github.com/joeseesun" target="_blank" class="pop-button" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                            <i class="fab fa-github"></i>
                        </a>
                        <a href="https://twitter.com/vista8" target="_blank" class="pop-button" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                            <i class="fab fa-twitter"></i>
                        </a>
                        <a href="mailto:vista8@gmail.com" class="pop-button" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                            <i class="fas fa-envelope"></i>
                        </a>
                        <div class="pop-button cursor-pointer" id="donateTrigger" style="padding: 10px; display: inline-flex; align-items: center; justify-content: center;">
                            <i class="fas fa-user-plus"></i>
                        </div>
                    </div>
                    <div>
                        <img src="https://pic.readnow.pro/2025/03/7b8ace4a97643e3ad0471cd0c26c02fb.png" alt="赞赏二维码" class="w-32 h-32 border-2 border-black" style="box-shadow: 5px 5px 0 var(--pop-black);">
                    </div>
                </div>
            </div>
            
            <div class="mt-10 pt-6 border-t border-white text-center">
                <p>© 2025 向阳乔木. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- 赞赏二维码模态框 -->
    <div class="donation-modal" id="donationModal">
        <div class="donation-content">
            <div class="donation-close" id="donationClose">
                <i class="fas fa-times"></i>
            </div>
            <div class="sound-effect mb-4">CONTACT ME!</div>
            <h3 class="text-xl font-bold mb-2">添加作者微信</h3>
            <p class="mb-4">欢迎添加作者微信交流</p>
            <img src="https://pic.readnow.pro/2025/03/03508452238484facfd20e858c2e16e1.png" alt="微信二维码" class="donation-qrcode">
            <p class="text-sm">扫描二维码添加微信</p>
        </div>
    </div>

    <!-- 返回顶部按钮 -->
    <div class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </div>

    <script>
        // 全局数据存储
        let allSites = [];
        let allCategories = [];
        let allTags = [];

        // 从后端API获取数据并初始化页面
        async function fetchDataAndRenderPage() {
            try {
                // 并行获取所有数据
                const [sitesResponse, categoriesResponse, tagsResponse] = await Promise.all([
                    fetch('/api/sites'),
                    fetch('/api/categories'),
                    fetch('/api/tags')
                ]);

                // 检查响应状态
                if (!sitesResponse.ok || !categoriesResponse.ok || !tagsResponse.ok) {
                    throw new Error('获取数据失败，请刷新页面重试');
                }

                // 解析响应数据
                allSites = await sitesResponse.json();
                allCategories = await categoriesResponse.json();
                allTags = await tagsResponse.json();

                console.log('加载的网站数:', allSites.length);
                console.log('加载的分类数:', allCategories.length);
                console.log('加载的标签数:', allTags.length);

                // 渲染页面内容
                renderCategories();
                renderSitesByCategory();

                // 初始化搜索功能
                initSearch();

                // 隐藏加载动画
                setTimeout(() => {
                    document.getElementById('pageLoader').style.opacity = '0';
                    setTimeout(() => {
                        document.getElementById('pageLoader').style.display = 'none';
                    }, 500);
                }, 800);
            } catch (error) {
                console.error('加载数据失败:', error);
                
                // 显示友好的错误提示
                document.getElementById('pageLoader').style.display = 'none';
                const mainContent = document.querySelector('main');
                mainContent.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-64 text-center p-8">
                        <div class="sound-effect mb-4">ERROR!</div>
                        <h2 class="text-2xl font-bold mb-2">数据加载失败</h2>
                        <p class="mb-4">很抱歉，加载数据时出现了问题: ${error.message}</p>
                        <button onclick="location.reload()" class="pop-button">
                            <i class="fas fa-redo mr-2"></i>重新加载
                        </button>
                    </div>
                `;
            }
        }

        // 生成占位图片函数
        function generatePlaceholder(siteName) {
            // 从网站名称生成颜色（简单哈希）
            const hash = siteName.split('').reduce((acc, char) => {
                return char.charCodeAt(0) + ((acc << 5) - acc);
            }, 0);
            const hue = Math.abs(hash) % 360;
            const colors = [
                'var(--pop-red)',
                'var(--pop-yellow)',
                'var(--pop-blue)'
            ];
            const bgColor = colors[Math.abs(hash) % 3];
            
            // 获取网站首字母或前两个字符作为显示内容
            const initial = siteName.length > 0 ? siteName.charAt(0).toUpperCase() : '?';
            const secondChar = siteName.length > 1 ? siteName.charAt(1) : '';
            const displayText = initial + secondChar;
            
            return `data:image/svg+xml,${encodeURIComponent(`
                <svg xmlns="http://www.w3.org/2000/svg" width="400" height="225" viewBox="0 0 400 225">
                    <rect width="400" height="225" fill="${bgColor}" />
                    <text x="50%" y="50%" font-family="Bangers, Impact, sans-serif" font-size="80" font-weight="bold" 
                          fill="white" text-anchor="middle" dominant-baseline="middle">
                        ${displayText}
                    </text>
                </svg>
            `)}`;
        }

        // 渲染分类选项卡
        function renderCategories() {
            const tabsContainer = document.querySelector('.category-tabs');
            
            // 清空现有的选项卡（保留"全部"选项卡）
            tabsContainer.innerHTML = `
                <div class="pop-button active" data-category="all">
                    <i class="fas fa-th-large mr-2"></i>全部
                </div>
            `;
            
            // 将分类按网站数量排序
            const sortedCategories = [...allCategories].sort((a, b) => b.siteCount - a.siteCount);
            
            // 只显示有网站的分类
            const categoriesToShow = sortedCategories.filter(cat => cat.siteCount > 0);
            
            // 添加分类选项卡
            categoriesToShow.forEach(category => {
                // 分类图标映射
                const iconMap = {
                    'AI工具': 'fas fa-robot',
                    '阅读与知识': 'fas fa-book-reader',
                    '精选Newsletter': 'fas fa-newspaper',
                    '生产力工具': 'fas fa-tools',
                    '开发工具': 'fas fa-code'
                };
                
                // 获取图标或使用默认图标
                const icon = iconMap[category.name] || 'fas fa-folder';
                
                const tabHtml = `
                    <div class="pop-button" data-category="${category.id}" style="background-color: var(--pop-white);">
                        <i class="${icon} mr-2"></i>${category.name}
                    </div>
                `;
                tabsContainer.innerHTML += tabHtml;
            });
            
            // 初始化分类选项卡点击事件
            initCategoryTabs();
        }

        // 根据分类渲染网站卡片
        function renderSitesByCategory() {
            // 清空主内容区域
            const mainContent = document.querySelector('main');
            mainContent.innerHTML = '';
            
            // 先添加筛选状态条 - 波普风格
            const filterStatusHtml = `
                <div id="filter-status" class="mb-8 hidden">
                    <div class="speech-bubble" style="max-width: 100%; margin: 0 auto 20px;">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <i class="fas fa-filter mr-2"></i>
                                <span id="filter-status-text" class="font-bold">正在筛选:</span>
                            </div>
                            <button id="clear-filter" class="pop-button" style="padding: 5px 10px; margin: 0;">
                                <i class="fas fa-times mr-1"></i>清除筛选
                            </button>
                        </div>
                    </div>
                </div>
            `;
            mainContent.innerHTML = filterStatusHtml;
            
            // 将分类按网站数量排序
            const sortedCategories = [...allCategories].sort((a, b) => b.siteCount - a.siteCount);
            
            // 只显示有网站的分类
            const categoriesToShow = sortedCategories.filter(cat => cat.siteCount > 0);
            
            // 为每个分类创建一个区域
            categoriesToShow.forEach(category => {
                // 获取属于此分类的所有网站
                const sitesInCategory = allSites.filter(site => 
                    site.categories.some(cat => cat.id === category.id)
                );
                
                if (sitesInCategory.length === 0) return;
                
                // 创建分类区域
                const sectionHtml = `
                    <section id="${category.name.toLowerCase().replace(/\s+/g, '-')}" class="mb-12 category-section" data-category="${category.id}">
                        <h2 class="text-3xl font-bold mb-6" style="border-bottom: 3px solid var(--pop-black); display: inline-block; padding-bottom: 5px;">
                            ${category.name}
                            <span class="sound-effect ml-4" style="font-size: 18px;">AMAZING!</span>
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 sites-container">
                            <!-- 网站卡片会在这里动态添加 -->
                        </div>
                    </section>
                `;
                
                mainContent.innerHTML += sectionHtml;
                
                // 为该分类添加网站卡片
                const sitesContainer = document.querySelector(`#${category.name.toLowerCase().replace(/\s+/g, '-')} .sites-container`);
                renderSiteCards(sitesInCategory, sitesContainer);
            });
            
            // 设置清除筛选按钮事件
            document.getElementById('clear-filter').addEventListener('click', clearFilter);
        }

        // 渲染网站卡片
        function renderSiteCards(sites, container) {
            // 按显示顺序排序网站
            const sortedSites = [...sites].sort((a, b) => a.displayOrder - b.displayOrder);
            
            sortedSites.forEach(site => {
                // 生成标签HTML
                const tagsHtml = site.tags.map(tag => {
                    return `<span class="pop-tag tag" data-tag="${tag.name}">${tag.name}</span>`;
                }).join('');
                
                // 检查是否为热门或新品
                const isHot = site.displayOrder < 3; // 假设前3个是热门
                const isNew = new Date(site.createdAt) > new Date(Date.now() - 7 * 24 * 60 * 60 * 1000); // 一周内的新品
                
                // 随机选择背景色
                const colors = ['var(--pop-red)', 'var(--pop-blue)', 'var(--pop-yellow)'];
                const bgColor = colors[Math.floor(Math.random() * colors.length)];
                
                // 热门标签HTML
                const explosionHtml = isHot ? 
                    `<div class="explosion" style="top: 10px; left: 10px;">热门!</div>` : 
                    (isNew ? `<div class="hot-label">新品!</div>` : '');
                
                // 生成占位图片URL
                const placeholderUrl = generatePlaceholder(site.name);
                
                // 生成卡片HTML（将a改为div）
                const cardHtml = `
                    <div class="pop-card site-card" data-site-id="${site.id}" data-tags="${site.tags.map(t => t.name).join(' ')}">
                        <div style="height: 160px; position: relative; overflow: hidden;" class="halftone card-img-container site-link" data-url="${site.url}">
                            <img src="${site.screenshot || placeholderUrl}" alt="${site.name}" 
                                style="position: absolute; width: 100%; height: 100%; object-fit: cover; z-index: 0;"
                                onerror="this.onerror=null; this.src='${placeholderUrl}';">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: ${bgColor}; opacity: 0.1; z-index: 1;"></div>
                            ${explosionHtml}
                        </div>
                        <div style="padding: 20px;" class="card-content">
                            <h3 class="text-xl font-bold mb-2 card-title site-link" data-url="${site.url}">${site.name}</h3>
                            <p style="margin-bottom: 15px;" class="card-description site-link" data-url="${site.url}">${site.description || '暂无描述'}</p>
                            <div class="tag-container">
                                ${tagsHtml}
                            </div>
                        </div>
                    </div>
                `;
                
                container.innerHTML += cardHtml;
            });
            
            // 在添加所有网站卡片后为元素添加事件处理
            addCardEventListeners();
        }

        // 为卡片元素添加事件监听器
        function addCardEventListeners() {
            // 为所有网站链接元素添加点击事件
            document.querySelectorAll('.site-link').forEach(element => {
                element.addEventListener('click', function() {
                    const url = this.getAttribute('data-url');
                    if (url) {
                        window.open(url, '_blank');
                    }
                });
                // 添加指针样式，提示可点击
                element.style.cursor = 'pointer';
            });
            
            // 为所有标签添加点击事件
            document.querySelectorAll('.tag').forEach(tag => {
                tag.addEventListener('click', function(e) {
                    e.stopPropagation(); // 阻止事件冒泡，避免触发卡片的点击事件
                    const tagName = this.getAttribute('data-tag');
                    if (tagName) {
                        filterSitesByTag(tagName);
                    }
                });
                // 添加指针样式，提示可点击
                tag.style.cursor = 'pointer';
            });
        }

        // 根据标签筛选网站
        function filterSitesByTag(tagName) {
            // 显示筛选状态 - 波普风格
            const filterStatus = document.getElementById('filter-status');
            const filterStatusText = document.getElementById('filter-status-text');
            filterStatus.classList.remove('hidden');
            filterStatusText.textContent = `正在筛选: "${tagName}"`;
            
            // 重置分类选项卡
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector('.category-tab[data-category="all"]').classList.add('active');
            
            // 显示所有分类区域
            document.querySelectorAll('.category-section').forEach(section => {
                section.style.display = 'block';
            });
            
            // 筛选卡片
            const searchTerm = tagName.toLowerCase();
            document.getElementById('searchInput').value = searchTerm; // 更新搜索框
            
            // 获取所有网站卡片
            const cards = document.querySelectorAll('.site-card');
            
            cards.forEach(card => {
                const tags = card.dataset.tags ? card.dataset.tags.toLowerCase() : '';
                
                if (tags.includes(searchTerm)) {
                    card.style.display = 'flex'; // 确保正确的显示模式
                    const section = card.closest('.category-section');
                    if (section) {
                        section.style.display = 'block';
                    }
                } else {
                    card.style.display = 'none';
                }
            });
            
            // 检查每个分类是否有可见的卡片
            const categorySections = document.querySelectorAll('.category-section');
            categorySections.forEach(section => {
                const visibleCards = Array.from(section.querySelectorAll('.site-card')).some(card => card.style.display !== 'none');
                section.style.display = visibleCards ? 'block' : 'none';
            });
            
            // 滚动到筛选状态条位置
            filterStatus.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // 添加清除筛选功能
        function clearFilter() {
            // 隐藏筛选状态条
            document.getElementById('filter-status').classList.add('hidden');
            
            // 清空搜索框
            document.getElementById('searchInput').value = '';
            
            // 显示所有卡片和分类
            document.querySelectorAll('.site-card').forEach(card => {
                card.style.display = 'flex';
            });
            
            document.querySelectorAll('.category-section').forEach(section => {
                section.style.display = 'block';
            });
            
            // 重置分类选项卡，保持"全部"选中
            document.querySelectorAll('.pop-button').forEach(tab => {
                tab.classList.remove('active');
                tab.style.backgroundColor = 'var(--pop-white)';
            });
            const allTab = document.querySelector('.pop-button[data-category="all"]');
            allTab.classList.add('active');
            allTab.style.backgroundColor = 'var(--pop-yellow)';
        }

        // 初始化分类选项卡
        function initCategoryTabs() {
            const categoryTabs = document.querySelectorAll('.category-tabs .pop-button');
            
            categoryTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const category = tab.dataset.category;
                    
                    // 更新活动选项卡
                    categoryTabs.forEach(t => {
                        t.classList.remove('active');
                        t.style.backgroundColor = 'var(--pop-white)';
                    });
                    tab.classList.add('active');
                    tab.style.backgroundColor = 'var(--pop-yellow)';
                    
                    // 显示/隐藏分类区域
                    const sections = document.querySelectorAll('.category-section');
                    if (category === 'all') {
                        sections.forEach(section => section.style.display = 'block');
                    } else {
                        sections.forEach(section => {
                            if (section.dataset.category === category) {
                                section.style.display = 'block';
                            } else {
                                section.style.display = 'none';
                            }
                        });
                    }
                });
            });
        }

        // 初始化搜索功能
        function initSearch() {
            const searchInput = document.getElementById('searchInput');
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                // 更新筛选状态显示
                const filterStatus = document.getElementById('filter-status');
                const filterStatusText = document.getElementById('filter-status-text');
                
                if (searchTerm) {
                    filterStatus.classList.remove('hidden');
                    filterStatusText.textContent = `正在搜索: "${searchTerm}"`;
                } else {
                    filterStatus.classList.add('hidden');
                }
                
                // 获取所有网站卡片
                const cards = document.querySelectorAll('.site-card');
                
                cards.forEach(card => {
                    const title = card.querySelector('.card-title').textContent.toLowerCase();
                    const description = card.querySelector('.card-description').textContent.toLowerCase();
                    const tags = card.dataset.tags ? card.dataset.tags.toLowerCase() : '';
                    
                    if (title.includes(searchTerm) || description.includes(searchTerm) || tags.includes(searchTerm)) {
                        card.style.display = 'flex'; // 使用flex确保卡片内容正确显示
                        const section = card.closest('.category-section');
                        if (section) {
                            section.style.display = 'block';
                        }
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // 检查每个分类是否有可见的卡片
                const categorySections = document.querySelectorAll('.category-section');
                categorySections.forEach(section => {
                    const visibleCards = Array.from(section.querySelectorAll('.site-card')).some(card => card.style.display !== 'none');
                    section.style.display = visibleCards ? 'block' : 'none';
                });
            });
        }

        // 页面加载时初始化
        window.addEventListener('load', () => {
            // 获取数据并渲染页面
            fetchDataAndRenderPage();
            
            // 添加返回顶部按钮的显示/隐藏逻辑
            const backToTopButton = document.getElementById('backToTop');
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 300) {
                    backToTopButton.classList.add('visible');
                } else {
                    backToTopButton.classList.remove('visible');
                }
            });
            
            backToTopButton.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
        });

        // 移动菜单
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        const overlay = document.getElementById('overlay');
        const mobileLinks = document.querySelectorAll('.mobile-link');
        
        menuToggle.addEventListener('click', () => {
            menuToggle.classList.toggle('active');
            mobileMenu.classList.toggle('active');
            overlay.classList.toggle('active');
            document.body.style.overflow = mobileMenu.classList.contains('active') ? 'hidden' : '';
        });
        
        overlay.addEventListener('click', () => {
            menuToggle.classList.remove('active');
            mobileMenu.classList.remove('active');
            overlay.classList.remove('active');
            document.body.style.overflow = '';
        });
        
        mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
                menuToggle.classList.remove('active');
                mobileMenu.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            });
        });

        // 主题切换
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark');
        });

        // 平滑滚动
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });

        // 赞赏模态框
        const donationModal = document.getElementById('donationModal');
        const donateTrigger = document.getElementById('donateTrigger');
        const donationClose = document.getElementById('donationClose');

        function openDonationModal() {
            donationModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeDonationModal() {
            donationModal.classList.remove('active');
            document.body.style.overflow = '';
        }

        donateTrigger.addEventListener('click', openDonationModal);
        donationClose.addEventListener('click', closeDonationModal);
        donationModal.addEventListener('click', (e) => {
            if (e.target === donationModal) {
                closeDonationModal();
            }
        });
    </script>
</body>
</html>
